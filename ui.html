<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <script>
        // Global variables
        let currentShape = 'classic';
        let currentErrorLevel = 'L';
        let currentLogoCut = false;
        let logoDataUrl = null;

        // Function to toggle placeholder visibility
        function togglePlaceholder(show) {
            console.log('Toggling placeholder:', show);
            const placeholder = document.getElementById('qr-placeholder');
            const previewContainer = document.getElementById('qr-preview');
            
            if (placeholder && previewContainer) {
                if (show) {
                    console.log('Showing placeholder, hiding preview');
                    placeholder.style.display = 'flex';
                    previewContainer.style.display = 'none';
                } else {
                    console.log('Showing preview, hiding placeholder');
                    placeholder.style.display = 'none';
                    previewContainer.style.display = 'flex';
                }
            } else {
                console.error('Placeholder or preview container not found:', {
                    placeholder: !!placeholder,
                    previewContainer: !!previewContainer
                });
            }
        }

        // Function to handle error correction level change
        function handleErrorCorrectionChange(level) {
            currentErrorLevel = level;
            const errorCorrectionButton = document.querySelector('.button3 .cancel');
            if (errorCorrectionButton) {
                errorCorrectionButton.textContent = level;
            }
            
            // Regenerate QR code if there's text
            const input = document.getElementById('qr-input');
            if (input && input.value.trim()) {
                generateQRCode(input.value.trim(), true);
            }
        }

        // Function to generate QR code
        function generateQRCode(text, isPreview = false) {
            try {
                console.log('Generating QR code:', { text, isPreview, currentShape, currentErrorLevel });
                if (!text) {
                    console.log('No text provided, showing placeholder');
                    togglePlaceholder(true);
                    return;
                }

                // Create QR code matrix with current error correction level
                console.log('Creating QR code matrix...');
                const qr = qrcode(0, currentErrorLevel);
                qr.addData(text);
                qr.make();
                
                // Get the QR code data URL
                const qrDataUrl = qr.createDataURL(4, 0);
                console.log('QR code data URL generated');

                // Create an image element to get the matrix
                const img = new Image();
                img.onload = function() {
                    // Create a canvas to get the pixel data
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    // Get the pixel data
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const matrix = [];
                    
                    // Convert pixel data to matrix
                    for (let y = 0; y < canvas.height; y++) {
                        const row = [];
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            // Check if pixel is black (R=0, G=0, B=0)
                            row.push(imageData.data[idx] === 0);
                        }
                        matrix.push(row);
                    }
                    
                    console.log('Matrix created, size:', matrix.length);

                    // Calculate dimensions
                    const size = isPreview ? 260 : 1000;
                    const moduleSize = size / matrix.length;
                    console.log('Calculated dimensions:', { size, moduleSize });

                    // Generate SVG string
                    let svgString = `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">`;
                    
                    // Add background with surface color
                    svgString += `<rect width="${size}" height="${size}" fill="var(--surface)"/>`;

                    // Draw QR code modules
                    for (let y = 0; y < matrix.length; y++) {
                        for (let x = 0; x < matrix.length; x++) {
                            if (matrix[y][x]) {
                                const xPos = x * moduleSize;
                                const yPos = y * moduleSize;

                                // Skip drawing if in logo cut area
                                if (currentLogoCut) {
                                    const centerX = size / 2;
                                    const centerY = size / 2;
                                    const logoSize = size * 0.25; // 25% of QR code size
                                    const logoX = centerX - logoSize / 2;
                                    const logoY = centerY - logoSize / 2;
                                    
                                    if (xPos >= logoX && xPos < logoX + logoSize &&
                                        yPos >= logoY && yPos < logoY + logoSize) {
                                        continue;
                                    }
                                }

                                switch (currentShape) {
                                    case 'dotted':
                                        // Draw circle
                                        const centerX = xPos + moduleSize / 2;
                                        const centerY = yPos + moduleSize / 2;
                                        const radius = moduleSize * 0.4;
                                        svgString += `<circle cx="${centerX}" cy="${centerY}" r="${radius}" fill="var(--text-primary)"/>`;
                                        break;

                                    case 'curved':
                                        // Draw rounded rectangle
                                        const cornerRadius = moduleSize * 0.2;
                                        svgString += `<path d="M ${xPos + cornerRadius} ${yPos} 
                                            h ${moduleSize - 2 * cornerRadius} 
                                            q ${cornerRadius} 0 ${cornerRadius} ${cornerRadius} 
                                            v ${moduleSize - 2 * cornerRadius} 
                                            q 0 ${cornerRadius} -${cornerRadius} ${cornerRadius} 
                                            h ${-moduleSize + 2 * cornerRadius} 
                                            q ${-cornerRadius} 0 ${-cornerRadius} ${-cornerRadius} 
                                            v ${-moduleSize + 2 * cornerRadius} 
                                            q 0 ${-cornerRadius} ${cornerRadius} ${-cornerRadius}" 
                                            fill="var(--text-primary)"/>`;
                                        break;

                                    default: // classic
                                        svgString += `<rect x="${xPos}" y="${yPos}" width="${moduleSize}" height="${moduleSize}" fill="var(--text-primary)"/>`;
                                }
                            }
                        }
                    }

                    svgString += '</svg>';

                    // Update preview or send to Figma
                    if (isPreview) {
                        const previewContainer = document.getElementById('qr-preview');
                        if (previewContainer) {
                            previewContainer.innerHTML = svgString;
                            togglePlaceholder(false);
                        }
                    } else {
                        parent.postMessage({ 
                            pluginMessage: { 
                                type: 'generate-qr',
                                svgString: svgString
                            }
                        }, '*');
                    }
                };
                img.src = qrDataUrl;
            } catch (error) {
                console.error('Error generating QR code:', error);
                if (!isPreview) {
                    parent.postMessage({ 
                        pluginMessage: { 
                            type: 'error',
                            message: 'Failed to generate QR code'
                        }
                    }, '*');
                }
            }
        }

        async function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => {
                    console.log('Script loaded successfully:', url);
                    resolve();
                };
                script.onerror = () => {
                    const error = new Error(`Failed to load script: ${url}`);
                    console.error(error);
                    reject(error);
                };
                document.head.appendChild(script);
            });
        }

        async function loadQRCodeLibrary() {
            try {
                console.log('Starting to load QRCode library...');
                await loadScript('https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js');
                console.log('Successfully loaded QRCode library');
                return true;
            } catch (error) {
                console.error('Failed to load QRCode library:', error);
                return false;
            }
        }

        // Load QRCode library when the page loads
        window.addEventListener('load', async () => {
            try {
                console.log('Page loaded, initializing...');
                const libraryLoaded = await loadQRCodeLibrary();
                if (!libraryLoaded) {
                    throw new Error('Failed to load QRCode library');
                }
                console.log('QRCode library loaded and ready');
                
                // Initialize UI elements after library is loaded
                const input = document.getElementById('qr-input');
                const generateBtn = document.getElementById('generate-btn');
                const previewContainer = document.getElementById('qr-preview');
                const placeholder = document.getElementById('qr-placeholder');
                
                console.log('UI elements initialized:', {
                    input: !!input,
                    generateBtn: !!generateBtn,
                    previewContainer: !!previewContainer,
                    placeholder: !!placeholder
                });

                // Set default style
                const classicButton = document.querySelector('.button[data-shape="classic"]');
                if (classicButton) {
                    classicButton.classList.add('active');
                    classicButton.style.borderColor = 'var(--primary)';
                    classicButton.style.background = 'var(--hover)';
                    currentShape = 'classic';
                    console.log('Initial shape set to:', currentShape);
                }

                // Add event listeners for style buttons
                document.querySelectorAll('.button, .button2').forEach(button => {
                    button.addEventListener('click', () => {
                        // Remove active state from all buttons
                        document.querySelectorAll('.button, .button2').forEach(btn => {
                            btn.classList.remove('active');
                            btn.style.borderColor = 'var(--stroke)';
                            btn.style.background = 'var(--bg)';
                        });
                        
                        // Set active state for clicked button
                        button.classList.add('active');
                        button.style.borderColor = 'var(--primary)';
                        button.style.background = 'var(--hover)';
                        
                        // Update current shape
                        currentShape = button.dataset.shape;
                        console.log('Selected shape:', currentShape);
                        
                        // Generate QR code with new style if there's text
                        if (input && input.value.trim()) {
                            generateQRCode(input.value.trim(), true);
                        }
                    });
                });

                // Add live preview with debouncing
                let debounceTimeout;
                input.addEventListener('input', (e) => {
                    const text = e.target.value.trim();
                    clearTimeout(debounceTimeout);
                    debounceTimeout = setTimeout(() => {
                        generateQRCode(text, true);
                    }, 300);
                });

                // Handle generate button click
                generateBtn.addEventListener('click', () => {
                    const text = input.value.trim();
                    if (text) {
                        generateQRCode(text, false);
                    }
                });

                // Handle Enter key
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const text = input.value.trim();
                        if (text) {
                            generateQRCode(text, false);
                        }
                    }
                });

                // Initial state
                togglePlaceholder(true);
                if (input.value.trim()) {
                    generateQRCode(input.value.trim(), true);
                }

                // Add error correction select functionality
                const errorCorrectionSelect = document.getElementById('error-correction-select');
                errorCorrectionSelect.addEventListener('change', (e) => {
                    handleErrorCorrectionChange(e.target.value);
                });

                // Set initial value
                errorCorrectionSelect.value = currentErrorLevel;

                // Add logo cut select functionality
                const logoCutSelect = document.getElementById('logo-cut-select');
                logoCutSelect.addEventListener('change', (e) => {
                    currentLogoCut = e.target.value === 'true';
                    console.log('Selected logo cut:', currentLogoCut);
                    generateQRCode(input.value.trim(), true);
                });

                // Set initial value
                logoCutSelect.value = currentLogoCut ? 'true' : 'false';

            } catch (error) {
                console.error('Failed to initialize:', error);
            }
        });
    </script>
    <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Basic */
      --basic-white: #ffffff;
      --basic-black: #000000;

      /* Primary */
        --primary: #7133f5;
        --primary-dark: #521abd;

      /* Variables */
      --bg: var(--figma-color-bg);
      --surface: var(--figma-color-bg-secondary);
      --stroke: var(--figma-color-border);
      --text-primary: var(--figma-color-text);
      --text-secondary: var(--figma-color-text-secondary);
        --text-tertiary: var(--figma-color-text-tertiary);
        --hover: var(--figma-color-bg-hover);

      /* Icons */
      --ison-size: 20px;

      /* Typography */
      --caption-font-family: 'Inter-Medium', sans-serif;
      --caption-font-size: 12px;
      --caption-line-height: 12px;
      --caption-font-weight: 500;
      --body-medium-font-family: 'Inter-Medium', sans-serif;
      --body-medium-font-size: 14px;
      --body-medium-line-height: 24px;
      --body-medium-font-weight: 500;
    }

    .plugin-frame {
        background: var(--bg);
        border-style: solid;
        border-color: var(--stroke);
        border-width: 0.5px;
      display: flex;
      flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        position: relative;
        overflow: hidden;
        height: 100vh;
    }

    .plugin-content {
      background: var(--bg);
        padding: 16px;
        display: flex;
        flex-direction: row;
        gap: 32px;
        align-items: flex-start;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
        overflow: hidden;
        width: 100%;
        flex: 1;
    }

    .right-side {
        display: flex;
        flex-direction: column;
      gap: 32px;
        align-items: flex-start;
        justify-content: flex-start;
        flex: 1;
        position: relative;
        width: 50%;
        min-height: 100%;
    }

    .left-side {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 50%;
        min-height: 100%;
        background: var(--basic-white);
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--stroke);
        background: var(--surface);
    }

    .plugin-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
    }

    .caption {
        color: var(--text-secondary);
        text-align: left;
        font-family: var(--caption-font-family);
        font-size: var(--caption-font-size);
        line-height: var(--caption-line-height);
        font-weight: var(--caption-font-weight);
        position: relative;
        align-self: stretch;
        height: 12px;
    }

    .input {
        background: var(--bg);
        border-radius: 8px;
        border-style: solid;
        border-color: var(--stroke);
        border-width: 1px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        height: 40px;
        position: relative;
    }

    .input input {
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-family: var(--body-medium-font-family);
        font-size: var(--body-medium-font-size);
        line-height: var(--body-medium-line-height);
        font-weight: var(--body-medium-font-weight);
        width: 100%;
        outline: none;
    }

    .input input::placeholder {
        color: var(--text-tertiary);
        font-family: var(--caption-font-family);
        font-size: var(--caption-font-size);
        line-height: var(--caption-line-height);
        font-weight: var(--caption-font-weight);
    }


    .input input:hover {
        border-color: var(--primary);
    }



    .row-fill {
        display: flex;
        flex-direction: row;
        gap: 8px;
        align-items: flex-start;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
    }

    .button, .button2 {
        background: var(--bg);
        border-radius: 8px;
        border-style: solid;
        border-color: var(--stroke);
        border-width: 1px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: center;
        flex: 1;
        height: 40px;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .button:hover, .button2:hover {
        background: var(--hover);
    }

    .button.active, .button2.active {
        border-color: var(--primary);
        background: var(--hover);
    }

    .button2 {
        background: var(--bg);
        border-radius: 8px;
        border-style: solid;
        border-color: var(--stroke);
        border-width: 1px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: center;
        flex: 1;
        height: 40px;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .button2:hover {
        background: var(--hover);
    }

    .frame-29 {
        display: flex;
        flex-direction: row;
        gap: 16px;
        align-items: flex-start;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
    }

    .row-fill2 {
      display: flex;
      flex-direction: column;
      gap: 8px;
        align-items: flex-start;
        justify-content: center;
        flex: 1;
        position: relative;
    }

    .button3 {
        background: var(--bg);
        border-radius: 8px;
        border-style: solid;
        border-color: var(--stroke);
        border-width: 1px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: space-between;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .button3:hover {
        background: var(--hover);
        border-color: var(--primary);
    }

    .combobox-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg);
        border: 1px solid var(--stroke);
        border-radius: 8px;
        margin-top: 4px;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .combobox-content.show {
        display: block;
    }

    .combobox-item {
        padding: 8px 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--text-primary);
        font-family: var(--body-medium-font-family);
        font-size: var(--body-medium-font-size);
        line-height: var(--body-medium-line-height);
        font-weight: var(--body-medium-font-weight);
    }

    .combobox-item:hover {
        background: var(--hover);
    }

    .combobox-item.selected {
        background: var(--hover);
    }

    .check-icon {
        opacity: 0;
        width: 16px;
        height: 16px;
    }

    .combobox-item.selected .check-icon {
        opacity: 1;
    }

    .chevron-icon {
        width: 16px;
        height: 16px;
        opacity: 0.5;
    }

    .select-button {
        color: var(--text-primary);
        text-align: left;
        font-family: var(--body-medium-font-family);
        font-size: var(--body-medium-font-size);
        line-height: var(--body-medium-line-height);
        font-weight: var(--body-medium-font-weight);
    }

    .row-fill3 {
        display: flex;
        flex-direction: row;
        gap: 16px;
        align-items: flex-start;
        justify-content: flex-start;
        align-self: stretch;
        flex-shrink: 0;
        position: relative;
    }

    .button4 {
        background: var(--surface);
        border-radius: 8px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        flex: 1;
        position: relative;
        cursor: pointer;
        border: none;
    }

    .button5 {
        background: var(--primary);
        border-radius: 8px;
        padding: 8px 16px;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
        justify-content: center;
        flex: 1;
        position: relative;
        cursor: pointer;
        border: none;
    }

    .body-medium {
        color: var(--text-primary);
        text-align: left;
        font-family: var(--body-medium-font-family);
        font-size: var(--body-medium-font-size);
        line-height: var(--body-medium-line-height);
        font-weight: var(--body-medium-font-weight);
    }

    .body-medium2 {
        color: var(--basic-white);
        text-align: left;
        font-family: var(--body-medium-font-family);
        font-size: var(--body-medium-font-size);
        line-height: var(--body-medium-line-height);
        font-weight: var(--body-medium-font-weight);
    }


    #qr-preview {
        display: none;
        width: 260px;
        height: 260px;
        justify-content: center;
        align-items: center;
    }

    #qr-preview svg {
        width: 100%;
        height: 100%;
    }

    .qr-placeholder {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .footer {
        background: var(--bg);
        border-style: solid;
        border-color: var(--stroke);
        border-width: 0.5px 0px 0px 0px;
        padding: 16px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        align-self: stretch;
        flex-shrink: 0;
        height: 40px;
        position: relative;
        margin-top: auto;
    }

    .footer-left {
        display: flex;
        flex-direction: row;
        gap: 8px;
        align-items: center;
        justify-content: flex-start;
        flex-shrink: 0;
        position: relative;
    }

    .frame-30 {
        background: var(--stroke);
        width: 0.5px;
        height: 12px;
    }

    .like-the-plugin {
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: center;
    }

    .caption3 {
        color: var(--text-secondary);
        text-align: left;
        font-family: var(--caption-font-family);
        font-size: var(--caption-font-size);
        line-height: var(--caption-line-height);
        font-weight: var(--caption-font-weight);
    }

    #preview {
        display: none;
    }

    .select-native {
        appearance: none;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--bg);
        color: var(--text-primary);
        padding: 8px 32px 8px 12px;
        border-radius: 8px;
        border: 1px solid var(--stroke);
        outline: none;
        cursor: pointer;
        width: 100%;
        height: 40px;
        text-align: center;
    }

    .select-native:hover {
        background-color: var(--hover);
    }

    .row-fill2 {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
        justify-content: center;
        flex: 1;
    }

    .row-fill2 svg {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        stroke: var(--text-secondary);
        pointer-events: none;
    }
    </style>
</head>
<body>
  	<div class="plugin-frame">
        <div class="plugin-content">
            <div class="right-side">
                <div class="plugin-section">
                    <div class="caption">Generate QR code</div>
                    <div class="input">
                        <input id="qr-input" type="text" placeholder="Enter your text of URL" />
                    </div>
                </div>
                <div class="plugin-section">
                    <div class="caption">Select the style</div>
                    <div class="row-fill">
                        <div class="button" data-shape="classic">
                            <svg width="20" height="20" class="icon">
                                <use xlink:href="#icon-qr-classic"></use>
                            </svg>
                        </div>
                        <div class="button2" data-shape="dotted">
                            <svg width="22" height="21" class="icon">
                                <use xlink:href="#icon-qr-dotted"></use>
                            </svg>
                        </div>
                        <div class="button2" data-shape="curved">
                            <svg width="22" height="21" class="icon">
                                <use xlink:href="#icon-qr-curved"></use>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="frame-29">
                    <div class="row-fill2">
                        <div class="caption">Error correction</div>
                            <select class="select-native" id="error-correction-select">
                                <option value="L">Low</option>
                                <option value="M">Medium</option>
                                <option value="Q">Quartile</option>
                                <option value="H">High</option>
                            </select>
                            <svg width="16" height="16">
                                <use xlink:href="#icon-chevron-down"></use>
                            </svg>
                    </div>
                    <div class="row-fill2">
                        <div class="caption">Cut for the logo</div>
                        <select class="select-native" id="logo-cut-select">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                        <svg width="16" height="16">
                            <use xlink:href="#icon-chevron-down"></use>
                        </svg>
                    </div>
                </div>
                <div class="row-fill3">
                    <button class="button4" id="clearBtn">
                        <div class="body-medium">Clear</div>
                    </button>
                    <button class="button5" id="generate-btn">
                        <div class="body-medium2">Paste QR Code</div>
                    </button>
                </div>
            </div>
            <div class="left-side">
                <div id="qr-preview"></div>
                <div id="qr-placeholder" class="qr-placeholder">
                    <svg width="64" height="64">
                        <use xlink:href="#icon-qr-placeholder"></use>
                    </svg>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="footer-left">
                <svg width="16" height="16">
                    <use xlink:href="#icon-info"></use>
                </svg>
                <div class="frame-30"></div>
                <div class="like-the-plugin">
                    <svg width="17" height="16">
                        <use xlink:href="#icon-heart"></use>
                    </svg>
                    <div class="caption3">Like the plugin!</div>
                </div>
            </div>
            <div class="caption3">Support the plugin</div>
  	</div>
    </div>

    <!-- SVG Icons -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <!-- QR Code Classic -->
        <symbol id="icon-qr-classic" viewBox="0 0 22 21">
            <path d="M17.0833 15.0834H15.0833V17.0834H17.0833V15.0834Z" fill="var(--text-primary)"/><path d="M13 11H11V13H13V11Z" fill="var(--text-primary)"/><path d="M15.0833 17.1667H13.0833V19.1667H15.0833V17.1667Z" fill="var(--text-primary)"/><path d="M13 15.0834H11V17.0834H13V15.0834Z" fill="var(--text-primary)"/><path d="M19.1667 13.0834H17.1667V15.0834H19.1667V13.0834Z" fill="var(--text-primary)"/><path d="M19.1667 17.1667H17.1667V19.1667H19.1667V17.1667Z" fill="var(--text-primary)"/><path d="M15.0833 13.0834H13.0833V15.0834H15.0833V13.0834Z" fill="var(--text-primary)"/><path d="M17.0833 11H15.0833V13H17.0833V11Z" fill="var(--text-primary)"/><path d="M16.0833 3.91671H14.0833V5.91671H16.0833V3.91671Z" fill="var(--text-primary)"/><path d="M5.91668 3.91671H3.91668V5.91671H5.91668V3.91671Z" fill="var(--text-primary)"/><path d="M5.91668 14.0834H3.91668V16.0834H5.91668V14.0834Z" fill="var(--text-primary)"/><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0.833374V9.00004H19.1667V0.833374H11ZM17.5833 7.41671H12.5833V2.41671H17.5833V7.41671Z" fill="var(--text-primary)"/><path fill-rule="evenodd" clip-rule="evenodd" d="M0.833344 9.00004H9.00001V0.833374H0.833344V9.00004ZM2.41668 2.41671H7.41668V7.41671H2.41668V2.41671Z" fill="var(--text-primary)"/><path fill-rule="evenodd" clip-rule="evenodd" d="M0.833344 19.1667H9.00001V11H0.833344V19.1667ZM2.41668 12.5834H7.41668V17.5834H2.41668V12.5834Z" fill="var(--text-primary)"/>
        </symbol>

        <!-- QR Code Dotted -->
        <symbol id="icon-qr-dotted" viewBox="0 0 22 21">
            <path d="M12 11C11.4167 11 11 11.4167 11 12C11 12.5834 11.4167 13 12 13C12.5833 13 13 12.5834 13 12C13 11.4167 12.5833 11 12 11Z" fill="var(--text-primary)"/><path d="M12 15.0834C11.4167 15.0834 11 15.5 11 16.0834C11 16.6667 11.4167 17.0834 12 17.0834C12.5833 17.0834 13 16.6667 13 16.0834C13 15.5 12.5833 15.0834 12 15.0834Z" fill="var(--text-primary)"/><path d="M14.0833 17.1667C13.5 17.1667 13.0833 17.5834 13.0833 18.1667C13.0833 18.75 13.5 19.1667 14.0833 19.1667C14.6667 19.1667 15.0833 18.75 15.0833 18.1667C15.0833 17.5834 14.6667 17.1667 14.0833 17.1667Z" fill="var(--text-primary)"/><path d="M16.0833 11C15.5 11 15.0833 11.4167 15.0833 12C15.0833 12.5834 15.5 13 16.0833 13C16.6667 13 17.0833 12.5834 17.0833 12C17.0833 11.4167 16.6667 11 16.0833 11Z" fill="var(--text-primary)"/><path d="M18.1667 13.0834C17.5833 13.0834 17.1667 13.5 17.1667 14.0834C17.1667 14.6667 17.5833 15.0834 18.1667 15.0834C18.75 15.0834 19.1667 14.6667 19.1667 14.0834C19.1667 13.5 18.75 13.0834 18.1667 13.0834Z" fill="var(--text-primary)"/><path d="M13.0833 14.0834C13.0833 14.6667 13.5 15.0834 14.0833 15.0834C14.6667 15.0834 15.0833 14.6667 15.0833 14.0834C15.0833 13.5 14.6667 13.0834 14.0833 13.0834C13.5 13.0834 13.0833 13.5 13.0833 14.0834Z" fill="var(--text-primary)"/><path d="M16.0833 15.0834C15.5 15.0834 15.0833 15.5 15.0833 16.0834C15.0833 16.6667 15.5 17.0834 16.0833 17.0834C16.6667 17.0834 17.0833 16.6667 17.0833 16.0834C17.0833 15.5 16.6667 15.0834 16.0833 15.0834Z" fill="var(--text-primary)"/><path d="M18.1667 17.1667C17.5833 17.1667 17.1667 17.5834 17.1667 18.1667C17.1667 18.75 17.5833 19.1667 18.1667 19.1667C18.75 19.1667 19.1667 18.75 19.1667 18.1667C19.1667 17.5834 18.75 17.1667 18.1667 17.1667Z" fill="var(--text-primary)"/><path d="M4.91668 11C2.66668 11 0.833344 12.8334 0.833344 15.0834C0.833344 17.3334 2.66668 19.1667 4.91668 19.1667C7.16668 19.1667 9.00001 17.3334 9.00001 15.0834C9.00001 12.8334 7.16668 11 4.91668 11ZM4.91668 17.5834C3.50001 17.5834 2.41668 16.5 2.41668 15.0834C2.41668 13.6667 3.58334 12.5834 4.91668 12.5834C6.25001 12.5834 7.41668 13.6667 7.41668 15.0834C7.41668 16.5 6.33334 17.5834 4.91668 17.5834Z" fill="var(--text-primary)"/><path d="M4.91668 0.833374C2.66668 0.833374 0.833344 2.66671 0.833344 4.91671C0.833344 7.16671 2.66668 9.00004 4.91668 9.00004C7.16668 9.00004 9.00001 7.16671 9.00001 4.91671C9.00001 2.66671 7.16668 0.833374 4.91668 0.833374ZM4.91668 7.41671C3.50001 7.41671 2.41668 6.33337 2.41668 4.91671C2.41668 3.50004 3.58334 2.41671 4.91668 2.41671C6.25001 2.41671 7.41668 3.50004 7.41668 4.91671C7.41668 6.33337 6.33334 7.41671 4.91668 7.41671Z" fill="var(--text-primary)"/><path d="M15.0833 9.00004C17.3333 9.00004 19.1667 7.16671 19.1667 4.91671C19.1667 2.66671 17.3333 0.833374 15.0833 0.833374C12.8333 0.833374 11 2.66671 11 4.91671C11 7.16671 12.8333 9.00004 15.0833 9.00004ZM15.0833 2.41671C16.5 2.41671 17.5833 3.50004 17.5833 4.91671C17.5833 6.33337 16.5 7.41671 15.0833 7.41671C13.6667 7.41671 12.5833 6.33337 12.5833 4.91671C12.5833 3.50004 13.75 2.41671 15.0833 2.41671Z" fill="var(--text-primary)"/><path d="M15.0833 5.91671C15.6667 5.91671 16.0833 5.50004 16.0833 4.91671C16.0833 4.33337 15.6667 3.91671 15.0833 3.91671C14.5 3.91671 14.0833 4.33337 14.0833 4.91671C14.0833 5.50004 14.5 5.91671 15.0833 5.91671Z" fill="var(--text-primary)"/><path d="M4.91668 3.91671C4.33334 3.91671 3.91668 4.33337 3.91668 4.91671C3.91668 5.50004 4.33334 5.91671 4.91668 5.91671C5.50001 5.91671 5.91668 5.50004 5.91668 4.91671C5.91668 4.33337 5.50001 3.91671 4.91668 3.91671Z" fill="var(--text-primary)"/><path d="M4.91668 14.0834C4.33334 14.0834 3.91668 14.5 3.91668 15.0834C3.91668 15.6667 4.33334 16.0834 4.91668 16.0834C5.50001 16.0834 5.91668 15.6667 5.91668 15.0834C5.91668 14.5 5.50001 14.0834 4.91668 14.0834Z" fill="var(--text-primary)"/>
        </symbol>

        <!-- QR Code Curved -->
        <symbol id="icon-qr-curved" viewBox="0 0 22 21">
            <path d="M7.41668 11H2.50001C2.08334 11 1.66668 11.1667 1.33334 11.5C1.00001 11.8334 0.833344 12.25 0.833344 12.6667V17.5834C0.833344 18 1.00001 18.4167 1.33334 18.75C1.66668 19.0834 2.08334 19.25 2.50001 19.25H7.41668C7.83334 19.25 8.25001 19.0834 8.58334 18.75C8.91668 18.4167 9.08334 18 9.08334 17.5834V12.6667C9.08334 12.25 8.91668 11.8334 8.58334 11.5C8.25001 11.1667 7.83334 11 7.41668 11ZM7.41668 17.5H2.50001V12.5834H7.41668V17.5Z" fill="var(--text-primary)"/><path d="M7.41668 0.833374H2.50001C2.08334 0.833374 1.66668 1.00004 1.33334 1.33337C1.00001 1.66671 0.833344 2.08337 0.833344 2.50004V7.41671C0.833344 7.83337 1.00001 8.25004 1.33334 8.58337C1.66668 8.91671 2.08334 9.08337 2.50001 9.08337H7.41668C7.83334 9.08337 8.25001 8.91671 8.58334 8.58337C8.91668 8.25004 9.08334 7.83337 9.08334 7.41671V2.50004C9.08334 2.08337 8.91668 1.66671 8.58334 1.33337C8.25001 1.00004 7.83334 0.833374 7.41668 0.833374ZM7.41668 7.33337H2.50001V2.50004H7.41668V7.33337Z" fill="var(--text-primary)"/><path d="M18.6667 1.33337C18.3333 1.00004 17.9167 0.833374 17.5 0.833374H12.5833C12.1667 0.833374 11.75 1.00004 11.4167 1.33337C11.0833 1.66671 10.9167 2.08337 10.9167 2.50004V7.41671C10.9167 7.83337 11.0833 8.25004 11.4167 8.58337C11.75 8.91671 12.1667 9.08337 12.5833 9.08337H17.5C17.9167 9.08337 18.3333 8.91671 18.6667 8.58337C19 8.25004 19.1667 7.83337 19.1667 7.41671V2.50004C19.1667 2.08337 19 1.66671 18.6667 1.33337ZM17.5833 7.33337H12.6667V2.50004H17.5833V7.33337Z" fill="var(--text-primary)"/><path d="M15.0833 5.91671C15.6667 5.91671 16.0833 5.50004 16.0833 4.91671C16.0833 4.33337 15.6667 3.91671 15.0833 3.91671C14.5 3.91671 14.0833 4.33337 14.0833 4.91671C14.0833 5.50004 14.5 5.91671 15.0833 5.91671Z" fill="var(--text-primary)"/><path d="M4.91668 5.91671C5.50001 5.91671 5.91668 5.50004 5.91668 4.91671C5.91668 4.33337 5.50001 3.91671 4.91668 3.91671C4.33334 3.91671 3.91668 4.33337 3.91668 4.91671C3.91668 5.50004 4.33334 5.91671 4.91668 5.91671C5.50001 5.91671 5.91668 5.50004 5.91668 4.91671C5.91668 4.33337 5.50001 3.91671 4.91668 3.91671Z" fill="var(--text-primary)"/><path d="M4.91668 16.0834C5.50001 16.0834 5.91668 15.6667 5.91668 15.0834C5.91668 14.5 5.50001 14.0834 4.91668 14.0834C4.33334 14.0834 3.91668 14.5 3.91668 15.0834C3.91668 15.6667 4.33334 16.0834 4.91668 16.0834C5.50001 16.0834 5.91668 15.6667 5.91668 15.0834C5.91668 14.5 5.50001 14.0834 4.91668 14.0834Z" fill="var(--text-primary)"/><path d="M15 17.5H11.6667C11.4167 17.5 11.25 17.5 11.0833 17.75C10.9167 18 10.8333 18.0834 10.8333 18.3334C10.8333 18.5834 10.8333 18.75 11.0833 18.9167C11.3333 19.0834 11.4167 19.1667 11.6667 19.1667H15C15.25 19.1667 15.4167 19.1667 15.5833 18.9167C15.75 18.6667 15.8333 18.5834 15.8333 18.3334C15.8333 18.0834 15.8333 17.9167 15.5833 17.75C15.3333 17.5834 15.25 17.5 15 17.5Z" fill="var(--text-primary)"/><path d="M18.3333 10.8334H16.6667C16.4167 10.8334 16.25 10.8334 16.0833 11.0834C15.9167 11.3334 15.8333 11.4167 15.8333 11.6667C15.8333 11.9167 15.8333 12.0834 16.0833 12.25C16.3333 12.4167 16.4167 12.5 16.6667 12.5H18.3333C18.5833 12.5 18.75 12.5 18.9167 12.25C19.0833 12 19.1667 11.9167 19.1667 11.6667C19.1667 11.4167 19.1667 11.25 18.9167 11.0834C18.6667 10.9167 18.5833 10.8334 18.3333 10.8334Z" fill="var(--text-primary)"/><path d="M18.3333 14.1667H14.1667V11.6667C14.1667 11.4167 14.1667 11.25 13.9167 11.0834C13.6667 10.9167 13.5833 10.8334 13.3333 10.8334C13.0833 10.8334 12.9167 10.8334 12.75 11.0834C12.5833 11.3334 12.5 11.4167 12.5 11.6667V14.1667H11.6667C11.4167 14.1667 11.25 14.1667 11.0833 14.4167C10.9167 14.6667 10.8333 14.75 10.8333 15C10.8333 15.25 10.8333 15.4167 11.0833 15.5834C11.3333 15.75 11.4167 15.8334 11.6667 15.8334H17.5V18.3334C17.5 18.5834 17.5 18.75 17.75 18.9167C18 19.0834 18.0833 19.1667 18.3333 19.1667C18.5833 19.1667 18.75 19.1667 18.9167 18.9167C19.0833 18.6667 19.1667 18.5834 19.1667 18.3334V15C19.1667 14.75 19.1667 14.5834 18.9167 14.4167C18.6667 14.25 18.5833 14.1667 18.3333 14.1667Z" fill="var(--text-primary)"/>
        </symbol>
            

        <!-- Chevron Down -->
        <symbol id="icon-chevron-down" viewBox="0 0 20 20">
            <path d="M5 7.5L10 12.5L15 7.5" stroke="white" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>

        <!-- Info Icon -->
        <symbol id="icon-info" viewBox="0 0 16 16">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M14.6666 8.00004C14.6666 11.682 11.682 14.6667 7.99998 14.6667C4.31798 14.6667 1.33331 11.682 1.33331 8.00004C1.33331 4.31804 4.31798 1.33337 7.99998 1.33337C11.682 1.33337 14.6666 4.31804 14.6666 8.00004ZM7.99998 5.16671C7.58598 5.16671 7.24998 5.50271 7.24998 5.91671C7.24998 6.04932 7.1973 6.17649 7.10353 6.27026C7.00976 6.36403 6.88259 6.41671 6.74998 6.41671C6.61737 6.41671 6.49019 6.36403 6.39643 6.27026C6.30266 6.17649 6.24998 6.04932 6.24998 5.91671C6.24999 5.63 6.32044 5.34768 6.45514 5.09459C6.58984 4.84149 6.78466 4.62537 7.02247 4.46522C7.26028 4.30507 7.5338 4.2058 7.81897 4.17615C8.10414 4.14649 8.39223 4.18736 8.65791 4.29515C8.92358 4.40294 9.1587 4.57435 9.3426 4.79432C9.52649 5.01428 9.65352 5.27606 9.71252 5.55663C9.77152 5.83721 9.76069 6.12798 9.68096 6.40338C9.60124 6.67878 9.45507 6.93038 9.25531 7.13604C9.19398 7.19915 9.13531 7.25848 9.07931 7.31404C8.9443 7.4434 8.81718 7.58076 8.69865 7.72537C8.55198 7.91337 8.49998 8.05137 8.49998 8.16671V8.66671C8.49998 8.79932 8.4473 8.92649 8.35353 9.02026C8.25976 9.11403 8.13259 9.16671 7.99998 9.16671C7.86737 9.16671 7.74019 9.11403 7.64643 9.02026C7.55266 8.92649 7.49998 8.79932 7.49998 8.66671V8.16671C7.49998 7.73004 7.70331 7.37604 7.90931 7.11137C8.06198 6.91537 8.25331 6.72471 8.40931 6.56871C8.45642 6.52204 8.49931 6.47893 8.53798 6.43937C8.64072 6.33364 8.71002 6.19997 8.73722 6.05507C8.76442 5.91017 8.74831 5.76047 8.69091 5.62468C8.6335 5.48888 8.53735 5.37302 8.41446 5.29157C8.29158 5.21011 8.14741 5.16668 7.99998 5.16671ZM7.99998 11.3334C8.17679 11.3334 8.34636 11.2631 8.47138 11.1381C8.59641 11.0131 8.66665 10.8435 8.66665 10.6667C8.66665 10.4899 8.59641 10.3203 8.47138 10.1953C8.34636 10.0703 8.17679 10 7.99998 10C7.82317 10 7.6536 10.0703 7.52857 10.1953C7.40355 10.3203 7.33331 10.4899 7.33331 10.6667C7.33331 10.8435 7.40355 11.0131 7.52857 11.1381C7.6536 11.2631 7.82317 11.3334 7.99998 11.3334Z" fill="#888888"/>            
        </symbol>

        <!-- Heart Icon -->
        <symbol id="icon-heart" viewBox="0 0 17 16">
            <path d="M1.83331 6.0913C1.83331 9.3333 4.51331 11.0606 6.47465 12.6073C7.16665 13.1526 7.83331 13.6666 8.49998 13.6666C9.16665 13.6666 9.83331 13.1533 10.5253 12.6066C12.4873 11.0613 15.1666 9.3333 15.1666 6.09197C15.1666 2.85064 11.5 0.54997 8.49998 3.6673C5.49998 0.54997 1.83331 2.8493 1.83331 6.0913Z" fill="#888888"/>            
        </symbol>

        <!-- QR Code Placeholder -->
        <symbol id="icon-qr-placeholder" viewBox="0 0 64 64">
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.12 38.5467L7.8249 39.5923L7.82518 39.5919L6.12 38.5467ZM7.88 36.7867L8.92518 38.4919L8.92721 38.4906L7.88 36.7867ZM27.2133 56.12L25.5084 55.0744L25.5082 55.0749L27.2133 56.12ZM25.4533 57.88L24.4082 56.1749L24.4061 56.1761L25.4533 57.88ZM9.15467 57.488L10.2 55.7829L10.1998 55.7829L9.15467 57.488ZM6.51467 54.848L4.80933 55.8929L4.8095 55.8932L6.51467 54.848ZM36.7867 7.88004L38.4916 8.92566L38.4918 8.92521L36.7867 7.88004ZM38.5467 6.12004L39.5918 7.82521L39.5939 7.82397L38.5467 6.12004ZM54.848 6.51204L55.8932 4.80687L55.8922 4.80629L54.848 6.51204ZM57.488 9.15204L59.1944 8.10885L59.1932 8.10687L57.488 9.15204ZM57.88 25.4534L56.1751 24.4078L56.1748 24.4082L57.88 25.4534ZM56.12 27.2134L55.0748 25.5082L55.0728 25.5094L56.12 27.2134ZM38.3707 36.8987L39.4817 38.5617L39.4824 38.5613L38.3707 36.8987ZM36.8987 38.3707L38.5612 39.4824L38.5617 39.4817L36.8987 38.3707ZM55.3733 58.2614L54.6084 56.4134L54.608 56.4136L55.3733 58.2614ZM58.2613 55.3734L56.4135 54.6081L56.4134 54.6084L58.2613 55.3734ZM6.512 9.15471L8.2171 10.2L8.21717 10.1999L6.512 9.15471ZM9.152 6.51471L8.1071 4.80937L8.10683 4.80953L9.152 6.51471ZM25.4533 6.12004L24.4077 7.82494L24.4082 7.82521L25.4533 6.12004ZM27.2133 7.88004L25.5082 8.92521L25.5094 8.92724L27.2133 7.88004ZM7.88 27.2134L8.92562 25.5085L8.92517 25.5082L7.88 27.2134ZM6.12 25.4534L7.82518 24.4082L7.82393 24.4062L6.12 25.4534ZM7.33334 45.0667C7.33334 43.2812 7.33545 42.0835 7.42267 41.1672C7.50702 40.2811 7.65664 39.8667 7.8249 39.5923L4.41511 37.5011C3.7967 38.5094 3.55298 39.6083 3.44067 40.7882C3.33122 41.938 3.33334 43.3588 3.33334 45.0667H7.33334ZM7.82518 39.5919C8.09995 39.1436 8.47688 38.7667 8.92517 38.4919L6.83483 35.0815C5.84859 35.686 5.01934 36.5153 4.41483 37.5015L7.82518 39.5919ZM8.92721 38.4906C9.19894 38.3236 9.61266 38.1738 10.5004 38.0894C11.4174 38.0022 12.6159 38 14.4 38V34C12.6934 34 11.272 33.9979 10.1216 34.1074C8.94201 34.2196 7.84106 34.4631 6.8328 35.0828L8.92721 38.4906ZM14.4 38H17.3333V34H14.4V38ZM17.3333 38C19.9046 38 21.631 38.0043 22.9187 38.1775C24.1484 38.343 24.675 38.6288 25.0231 38.9769L27.8515 36.1485C26.637 34.9339 25.1262 34.4385 23.452 34.2132C21.8356 33.9958 19.7914 34 17.3333 34V38ZM25.0231 38.9769C25.3712 39.325 25.6571 39.8516 25.8225 41.0814C25.9957 42.369 26 44.0954 26 46.6667H30C30 44.2086 30.0043 42.1644 29.7868 40.5481C29.5616 38.8738 29.0661 37.3631 27.8515 36.1485L25.0231 38.9769ZM26 46.6667V49.6H30V46.6667H26ZM26 49.6C26 51.3855 25.9979 52.5833 25.9107 53.4995C25.8263 54.3857 25.6767 54.8001 25.5084 55.0744L28.9182 57.1657C29.5366 56.1573 29.7804 55.0584 29.8927 53.8786C30.0021 52.7288 30 51.3079 30 49.6H26ZM25.5082 55.0749C25.2334 55.5232 24.8565 55.9001 24.4082 56.1749L26.4985 59.5852C27.4848 58.9807 28.314 58.1515 28.9185 57.1652L25.5082 55.0749ZM24.4061 56.1761C24.1344 56.3431 23.7207 56.4929 22.8329 56.5774C21.916 56.6646 20.7174 56.6667 18.9333 56.6667V60.6667C20.6399 60.6667 22.0614 60.6688 23.2117 60.5594C24.3913 60.4472 25.4923 60.2036 26.5005 59.584L24.4061 56.1761ZM18.9333 56.6667C16.2759 56.6667 14.4233 56.6646 12.9903 56.5283C11.587 56.3949 10.7941 56.1471 10.2 55.7829L8.10938 59.1931C9.43795 60.0076 10.9157 60.3491 12.6117 60.5104C14.278 60.6688 16.3534 60.6667 18.9333 60.6667V56.6667ZM10.1998 55.7829C9.39292 55.2883 8.71444 54.6098 8.21984 53.8029L4.8095 55.8932C5.63383 57.2381 6.76462 58.3689 8.1095 59.1932L10.1998 55.7829ZM8.22001 53.8031C7.85381 53.2055 7.60562 52.4111 7.47198 51.0087C7.33546 49.5759 7.33334 47.7242 7.33334 45.0667H3.33334C3.33334 47.6466 3.33122 49.7215 3.49002 51.3881C3.65172 53.085 3.9942 54.5626 4.80933 55.8929L8.22001 53.8031ZM38 14.4C38 12.6146 38.0021 11.4168 38.0893 10.5006C38.1737 9.61442 38.3233 9.20001 38.4916 8.92566L35.0818 6.83442C34.4634 7.84273 34.2196 8.94166 34.1073 10.1215C33.9979 11.2713 34 12.6922 34 14.4H38ZM38.4918 8.92521C38.7666 8.47692 39.1435 8.09999 39.5918 7.82521L37.5015 4.41487C36.5153 5.01938 35.686 5.84862 35.0815 6.83487L38.4918 8.92521ZM39.5939 7.82397C39.8656 7.65696 40.2793 7.50717 41.1671 7.42272C42.084 7.33549 43.2826 7.33337 45.0667 7.33337V3.33337C43.3601 3.33337 41.9386 3.33126 40.7883 3.4407C39.6087 3.55291 38.5077 3.79645 37.4995 4.41612L39.5939 7.82397ZM45.0667 7.33337C47.724 7.33337 49.5767 7.33548 51.0101 7.47173C52.4136 7.60515 53.2078 7.85296 53.8038 8.21779L55.8922 4.80629C54.5628 3.99246 53.085 3.65093 51.3886 3.48968C49.722 3.33127 47.6466 3.33337 45.0667 3.33337V7.33337ZM53.8028 8.21721C54.6098 8.71181 55.2882 9.39029 55.7828 10.1972L59.1932 8.10687C58.3688 6.76199 57.2381 5.6312 55.8932 4.80687L53.8028 8.21721ZM55.7816 10.1952C56.1471 10.793 56.3949 11.5885 56.5283 12.992C56.6646 14.4254 56.6667 16.2774 56.6667 18.9334H60.6667C60.6667 16.3547 60.6688 14.28 60.5104 12.6135C60.3491 10.9169 60.0076 9.43904 59.1944 8.10885L55.7816 10.1952ZM56.6667 18.9334C56.6667 20.7188 56.6646 21.9166 56.5773 22.8328C56.493 23.719 56.3434 24.1334 56.1751 24.4078L59.5849 26.499C60.2033 25.4907 60.447 24.3918 60.5593 23.2119C60.6688 22.0621 60.6667 20.6412 60.6667 18.9334H56.6667ZM56.1748 24.4082C55.9 24.8565 55.5231 25.2334 55.0748 25.5082L57.1652 28.9185C58.1514 28.314 58.9807 27.4848 59.5852 26.4985L56.1748 24.4082ZM55.0728 25.5094C54.8011 25.6765 54.3873 25.8262 53.4996 25.9107C52.5826 25.9979 51.3841 26 49.6 26V30C51.3066 30 52.7281 30.0022 53.8784 29.8927C55.058 29.7805 56.1589 29.537 57.1672 28.9173L55.0728 25.5094ZM49.6 26H46.6667V30H49.6V26ZM46.6667 26C44.0954 26 42.369 25.9958 41.0813 25.8226C39.8516 25.6571 39.325 25.3712 38.9769 25.0232L36.1485 27.8516C37.363 29.0662 38.8738 29.5616 40.548 29.7868C42.1644 30.0043 44.2086 30 46.6667 30V26ZM38.9769 25.0232C38.6288 24.6751 38.3429 24.1485 38.1775 22.9187C38.0043 21.6311 38 19.9046 38 17.3334H34C34 19.7914 33.9957 21.8357 34.2132 23.452C34.4384 25.1263 34.9339 26.637 36.1485 27.8516L38.9769 25.0232ZM38 17.3334V14.4H34V17.3334H38ZM50.6667 34H45.3333V38H50.6667V34ZM45.3333 34C43.5016 34 41.9776 33.9976 40.7486 34.1226C39.4862 34.2511 38.3146 34.5303 37.259 35.2361L39.4824 38.5613C39.7707 38.3685 40.2072 38.1984 41.1534 38.1021C42.133 38.0025 43.4184 38 45.3333 38V34ZM37.2596 35.2357C36.4586 35.7709 35.7708 36.4586 35.2356 37.2597L38.5617 39.4817C38.8049 39.1176 39.1176 38.805 39.4817 38.5617L37.2596 35.2357ZM35.2361 37.259C34.5301 38.3149 34.251 39.4873 34.1226 40.7497C33.9976 41.979 34 43.503 34 45.3334H38C38 43.4198 38.0024 42.1344 38.1021 41.1544C38.1984 40.2074 38.3686 39.7705 38.5612 39.4824L35.2361 37.259ZM45.3333 60.6667H50.6667V56.6667H45.3333V60.6667ZM50.6667 60.6667C51.882 60.6667 52.8935 60.6678 53.7209 60.6114C54.5661 60.5538 55.3647 60.4297 56.1386 60.1092L54.608 56.4136C54.4033 56.4984 54.0912 56.5769 53.4491 56.6207C52.7891 56.6656 51.9367 56.6667 50.6667 56.6667V60.6667ZM56.1383 60.1093C57.0286 59.7408 57.8376 59.2004 58.5189 58.519L55.6905 55.6906C55.3808 56.0003 55.0131 56.2459 54.6084 56.4134L56.1383 60.1093ZM58.5189 58.519C59.2003 57.8376 59.7407 57.0286 60.1093 56.1383L56.4134 54.6084C56.2459 55.0131 56.0002 55.3808 55.6905 55.6906L58.5189 58.519ZM60.1091 56.1387C60.4296 55.3648 60.5538 54.5662 60.6114 53.721C60.6677 52.8936 60.6667 51.882 60.6667 50.6667H56.6667C56.6667 51.9367 56.6656 52.7892 56.6206 53.4491C56.5769 54.0913 56.4983 54.4033 56.4135 54.6081L60.1091 56.1387ZM7.33334 18.9334C7.33334 16.276 7.33545 14.4234 7.47169 12.9903C7.60511 11.587 7.8529 10.7941 8.2171 10.2L4.8069 8.10942C3.99244 9.43799 3.65089 10.9158 3.48965 12.6117C3.33123 14.278 3.33334 16.3534 3.33334 18.9334H7.33334ZM8.21717 10.1999C8.71177 9.39295 9.39025 8.71448 10.1972 8.21988L8.10683 4.80953C6.76195 5.63387 5.63116 6.76466 4.80683 8.10953L8.21717 10.1999ZM10.1969 8.22005C10.7944 7.85394 11.5894 7.60569 12.9923 7.47203C14.4255 7.33549 16.2772 7.33337 18.9333 7.33337V3.33337C16.3548 3.33337 14.2798 3.33126 12.613 3.49006C10.916 3.65173 9.4376 3.99414 8.1071 4.80937L10.1969 8.22005ZM18.9333 7.33337C20.7188 7.33337 21.9166 7.33549 22.8328 7.42271C23.719 7.50706 24.1334 7.65668 24.4077 7.82494L26.499 4.41514C25.4906 3.79674 24.3917 3.55302 23.2119 3.44071C22.0621 3.33126 20.6412 3.33337 18.9333 3.33337V7.33337ZM24.4082 7.82521C24.8565 8.09999 25.2334 8.47692 25.5082 8.92521L28.9185 6.83487C28.314 5.84862 27.4848 5.01938 26.4985 4.41487L24.4082 7.82521ZM25.5094 8.92724C25.6764 9.19898 25.8262 9.6127 25.9107 10.5004C25.9979 11.4174 26 12.616 26 14.4H30C30 12.6934 30.0021 11.272 29.8927 10.1216C29.7805 8.94205 29.5369 7.8411 28.9173 6.83284L25.5094 8.92724ZM26 14.4V17.3334H30V14.4H26ZM26 17.3334C26 19.9046 25.9957 21.6311 25.8225 22.9187C25.6571 24.1485 25.3712 24.6751 25.0231 25.0232L27.8515 27.8516C29.0661 26.637 29.5616 25.1263 29.7868 23.452C30.0043 21.8357 30 19.7914 30 17.3334H26ZM25.0231 25.0232C24.675 25.3712 24.1484 25.6571 22.9187 25.8226C21.631 25.9958 19.9046 26 17.3333 26V30C19.7914 30 21.8356 30.0043 23.452 29.7868C25.1262 29.5616 26.637 29.0662 27.8515 27.8516L25.0231 25.0232ZM17.3333 26H14.4V30H17.3333V26ZM14.4 26C12.6145 26 11.4168 25.9979 10.5005 25.9107C9.61439 25.8264 9.19998 25.6767 8.92562 25.5085L6.83438 28.9183C7.8427 29.5367 8.94162 29.7804 10.1215 29.8927C11.2712 30.0022 12.6921 30 14.4 30V26ZM8.92517 25.5082C8.47688 25.2334 8.09995 24.8565 7.82518 24.4082L4.41483 26.4985C5.01934 27.4848 5.84859 28.314 6.83483 28.9185L8.92517 25.5082ZM7.82393 24.4062C7.65693 24.1344 7.50713 23.7207 7.42268 22.833C7.33545 21.916 7.33334 20.7174 7.33334 18.9334H3.33334C3.33334 20.64 3.33122 22.0614 3.44066 23.2118C3.55287 24.3914 3.79641 25.4923 4.41608 26.5006L7.82393 24.4062Z" fill="#521ABD"/>
            <path d="M44 16.6667C44 15.2934 44 14.6054 44.3467 14.12C44.4674 13.9488 44.6162 13.7992 44.7867 13.6774C45.272 13.3334 45.96 13.3334 47.3333 13.3334C48.7067 13.3334 49.3947 13.3334 49.88 13.68C50.0512 13.8008 50.2009 13.9496 50.3227 14.12C50.6667 14.6054 50.6667 15.2934 50.6667 16.6667C50.6667 18.04 50.6667 18.728 50.32 19.2134C50.1992 19.3846 50.0505 19.5342 49.88 19.656C49.3947 20 48.7067 20 47.3333 20C45.96 20 45.272 20 44.7867 19.6534C44.6155 19.5326 44.4658 19.3838 44.344 19.2134C44 18.728 44 18.04 44 16.6667Z" fill="#7133F5"/>
            <path d="M34 58.6667C34 59.1971 34.2107 59.7058 34.5858 60.0809C34.9609 60.456 35.4696 60.6667 36 60.6667C36.5304 60.6667 37.0391 60.456 37.4142 60.0809C37.7893 59.7058 38 59.1971 38 58.6667H34ZM34 50.6667V58.6667H38V50.6667H34Z" fill="#7133F5"/>
            <path d="M60.6667 36C60.6667 35.4696 60.456 34.9609 60.0809 34.5858C59.7058 34.2108 59.1971 34 58.6667 34C58.1362 34 57.6275 34.2108 57.2525 34.5858C56.8774 34.9609 56.6667 35.4696 56.6667 36H60.6667ZM60.6667 45.3334V36H56.6667V45.3334H60.6667Z" fill="#7133F5"/>
            <path d="M13.3333 16.6667C13.3333 15.2934 13.3333 14.6054 13.68 14.12C13.8008 13.9488 13.9495 13.7992 14.12 13.6774C14.6053 13.3334 15.2933 13.3334 16.6667 13.3334C18.04 13.3334 18.728 13.3334 19.2133 13.68C19.3845 13.8008 19.5342 13.9496 19.656 14.12C20 14.6054 20 15.2934 20 16.6667C20 18.04 20 18.728 19.6533 19.2134C19.5326 19.3846 19.3838 19.5342 19.2133 19.656C18.728 20 18.04 20 16.6667 20C15.2933 20 14.6053 20 14.12 19.6534C13.9488 19.5326 13.7992 19.3838 13.6773 19.2134C13.3333 18.728 13.3333 18.04 13.3333 16.6667ZM13.3333 47.3334C13.3333 45.96 13.3333 45.272 13.68 44.7867C13.8008 44.6155 13.9495 44.4659 14.12 44.344C14.6053 44 15.2933 44 16.6667 44C18.04 44 18.728 44 19.2133 44.3467C19.3845 44.4675 19.5342 44.6162 19.656 44.7867C20 45.272 20 45.96 20 47.3334C20 48.7067 20 49.3947 19.6533 49.88C19.5326 50.0512 19.3838 50.2009 19.2133 50.3227C18.728 50.6667 18.04 50.6667 16.6667 50.6667C15.2933 50.6667 14.6053 50.6667 14.12 50.32C13.9488 50.1993 13.7992 50.0505 13.6773 49.88C13.3333 49.3947 13.3333 48.7067 13.3333 47.3334ZM42.6667 47.3334C42.6667 45.4614 42.6667 44.5254 43.1173 43.8507C43.3114 43.5606 43.5606 43.3115 43.8507 43.1174C44.5253 42.6667 45.4613 42.6667 47.3333 42.6667C49.2053 42.6667 50.1413 42.6667 50.816 43.1174C51.1061 43.3115 51.3552 43.5606 51.5493 43.8507C52 44.5254 52 45.4614 52 47.3334C52 49.2054 52 50.1414 51.5493 50.816C51.3552 51.1061 51.1061 51.3553 50.816 51.5494C50.1413 52 49.2053 52 47.3333 52C45.4613 52 44.5253 52 43.8507 51.5494C43.5606 51.3553 43.3114 51.1061 43.1173 50.816C42.6667 50.1414 42.6667 49.2054 42.6667 47.3334Z" fill="#7133F5"/>            
        </symbol>
    </svg>

    <script>
    // Function to toggle placeholder visibility
    function togglePlaceholder(show) {
        console.log('Toggling placeholder:', show);
        const placeholder = document.getElementById('qr-placeholder');
        const previewContainer = document.getElementById('qr-preview');
        
        if (placeholder && previewContainer) {
            if (show) {
                console.log('Showing placeholder, hiding preview');
                placeholder.style.display = 'flex';
                previewContainer.style.display = 'none';
            } else {
                console.log('Showing preview, hiding placeholder');
                placeholder.style.display = 'none';
                previewContainer.style.display = 'flex';
            }
        } else {
            console.error('Placeholder or preview container not found:', {
                placeholder: !!placeholder,
                previewContainer: !!previewContainer
            });
        }
    }

    // Function to generate QR code
    function generateQRCode(text, isPreview = false) {
        try {
            console.log('Generating QR code:', { text, isPreview, currentShape, currentErrorLevel });
            if (!text) {
                console.log('No text provided, showing placeholder');
                togglePlaceholder(true);
                return;
            }

            // Create QR code matrix with current error correction level
            console.log('Creating QR code matrix...');
            const qr = qrcode(0, currentErrorLevel);
            qr.addData(text);
            qr.make();
            
            // Get the QR code data URL
            const qrDataUrl = qr.createDataURL(4, 0);
            console.log('QR code data URL generated');

            // Create an image element to get the matrix
            const img = new Image();
            img.onload = function() {
                // Create a canvas to get the pixel data
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Get the pixel data
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const matrix = [];
                
                // Convert pixel data to matrix
                for (let y = 0; y < canvas.height; y++) {
                    const row = [];
                    for (let x = 0; x < canvas.width; x++) {
                        const idx = (y * canvas.width + x) * 4;
                        // Check if pixel is black (R=0, G=0, B=0)
                        row.push(imageData.data[idx] === 0);
                    }
                    matrix.push(row);
                }
                
                console.log('Matrix created, size:', matrix.length);

                // Calculate dimensions
                const size = isPreview ? 260 : 1000;
                const moduleSize = size / matrix.length;
                console.log('Calculated dimensions:', { size, moduleSize });

                // Generate SVG string
                let svgString = `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">`;
                
                // Add background with surface color
                svgString += `<rect width="${size}" height="${size}" fill="var(--surface)"/>`;

                // Draw QR code modules
                for (let y = 0; y < matrix.length; y++) {
                    for (let x = 0; x < matrix.length; x++) {
                        if (matrix[y][x]) {
                            const xPos = x * moduleSize;
                            const yPos = y * moduleSize;

                            // Skip drawing if in logo cut area
                            if (currentLogoCut) {
                                const centerX = size / 2;
                                const centerY = size / 2;
                                const logoSize = size * 0.35; // 40% of QR code size
                                const logoX = centerX - logoSize / 2;
                                const logoY = centerY - logoSize / 2;
                                
                                if (xPos >= logoX && xPos < logoX + logoSize &&
                                    yPos >= logoY && yPos < logoY + logoSize) {
                                    continue;
                                }
                            }

                            switch (currentShape) {
                                case 'dotted':
                                    // Draw circle
                                    const centerX = xPos + moduleSize / 2;
                                    const centerY = yPos + moduleSize / 2;
                                    const radius = moduleSize * 0.4;
                                    svgString += `<circle cx="${centerX}" cy="${centerY}" r="${radius}" fill="var(--text-primary)"/>`;
                                    break;

                                case 'curved':
                                    // Draw rounded rectangle
                                    const cornerRadius = moduleSize * 0.2;
                                    svgString += `<path d="M ${xPos + cornerRadius} ${yPos} 
                                        h ${moduleSize - 2 * cornerRadius} 
                                        q ${cornerRadius} 0 ${cornerRadius} ${cornerRadius} 
                                        v ${moduleSize - 2 * cornerRadius} 
                                        q 0 ${cornerRadius} -${cornerRadius} ${cornerRadius} 
                                        h ${-moduleSize + 2 * cornerRadius} 
                                        q ${-cornerRadius} 0 ${-cornerRadius} ${-cornerRadius} 
                                        v ${-moduleSize + 2 * cornerRadius} 
                                        q 0 ${-cornerRadius} ${cornerRadius} ${-cornerRadius}" 
                                        fill="var(--text-primary)"/>`;
                                    break;

                                default: // classic
                                    svgString += `<rect x="${xPos}" y="${yPos}" width="${moduleSize}" height="${moduleSize}" fill="var(--text-primary)"/>`;
                            }
                        }
                    }
                }

                svgString += '</svg>';

                // Update preview or send to Figma
                if (isPreview) {
                    const previewContainer = document.getElementById('qr-preview');
                    if (previewContainer) {
                        previewContainer.innerHTML = svgString;
                        togglePlaceholder(false);
                    }
                } else {
                    parent.postMessage({ 
                        pluginMessage: { 
                            type: 'generate-qr',
                            svgString: svgString
                        }
                    }, '*');
                }
            };
            img.src = qrDataUrl;
        } catch (error) {
            console.error('Error generating QR code:', error);
            if (!isPreview) {
                parent.postMessage({ 
                    pluginMessage: { 
                        type: 'error',
                        message: 'Failed to generate QR code'
                    }
                }, '*');
            }
        }
    }
    </script>
</body>
</html>
